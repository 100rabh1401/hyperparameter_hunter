<html>
<head>
    <link rel="stylesheet" href="./scripts/styles/github.css"/>
</head>
<body>
<button class="optimize-library" value="xgboost" id="optimize-library-xgboost">XGBoost</button>
<button class="optimize-library" value="keras" id="optimize-library-keras">Keras</button>
<button class="optimize-library" value="sklearn" id="optimize-library-sklearn">SKLearn</button>
<button class="optimize-library" value="lightgbm" id="optimize-library-lightgbm">LightGBM</button>
<button class="optimize-library" value="catboost" id="optimize-library-catboost">CatBoost</button>
<button class="optimize-library" value="rgf" id="optimize-library-rgf">RGF</button>

<div id="optimizeLibraryContent" style="width: 100%;"></div>

<script type="text/javascript" src="scripts/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="scripts/highlight.pack.js"></script>
<script type="text/javascript">
    var activeButtonTextColor = '#3ECAE8';
    var defaultButtonTextColor = 'black';
    var selectedOptimizeLibrary = 'xgboost';
    var optimizeLibraryLookup = {
        'xgboost': (
            'optimizer = BayesianOptimization(iterations=10)\n' +
            'optimizer.set_experiment_guidelines(\n' +
            '   model_initializer=XGBClassifier,\n' +
            '   model_init_params=dict(\n' +
            '       max_depth=Integer(low=2, high=20),\n' +
            '       learning_rate=Real(0.0001, 0.5),\n' +
            '       n_estimators=200,\n' +
            '       subsample=0.5,\n' +
            '       booster=Categorical([\'gbtree\', \'gblinear\', \'dart\']),\n' +
            '   )\n' +
            ')\n' +
            'optimizer.go()'
        ),
        'keras': (
            'def build_fn(input_shape):\n' +
            '   model = Sequential([\n' +
            '       Dense(Integer(50, 150), input_shape=input_shape, activation=\'relu\'),\n' +
            '       Dropout(Real(0.2, 0.7)),\n' +
            '       Dense(1, activation=Categorical([\'sigmoid\', \'softmax\'])),\n' +
            '   ])\n' +
            '   model.compile(\n' +
            '       optimizer=Categorical([\'adam\', \'rmsprop\', \'sgd\', \'adadelta\']),\n' +
            '       loss=\'binary_crossentropy\', metrics=[\'accuracy\'],\n' +
            '   )\n' +
            '   return model\n' +
            '\n' +
            'optimizer = RandomForestOptimization(iterations=7)\n' +
            'optimizer.set_experiment_guidelines(\n' +
            '   model_initializer=KerasClassifier,\n' +
            '   model_init_params=build_fn,\n' +
            '   model_extra_params=dict(\n' +
            '       callbacks=[ReduceLROnPlateau(patience=Integer(5, 10))],\n' +
            '       batch_size=Categorical([32, 64]),\n' +
            '       epochs=10, verbose=0\n' +
            '   )\n' +
            ')\n' +
            'optimizer.go()'
        ),
        'sklearn': (
            'optimizer = DummySearch(iterations=42)\n' +
            'optimizer.set_experiment_guidelines(\n' +
            '   model_initializer=AdaBoostClassifier,  # (Or any of the dozens of other SK-Learn algorithms)\n' +
            '   model_init_params=dict(\n' +
            '       n_estimators=Integer(75, 150),\n' +
            '       learning_rate=Real(0.8, 1.3),\n' +
            "       algorithm='SAMME.R'\n" +
            '   )\n' +
            ')\n' +
            'optimizer.go()'
        ),
        'lightgbm': (
            'optimizer = BayesianOptimization(iterations=100)\n' +
            'optimizer.set_experiment_guidelines(\n' +
            '   model_initializer=LGBMClassifier,\n' +
            '   model_init_params=dict(\n' +
            '       boosting_type=Categorical([\'gbdt\', \'dart\']),\n' +
            '       num_leaves=Integer(5, 20),\n' +
            '       max_depth=-1,\n' +
            '       min_child_samples=5,\n' +
            '       subsample=0.5\n' +
            '   )\n' +
            ')\n' +
            'optimizer.go()'
        ),
        'catboost': (
            'optimizer = GradientBoostedRegressionTreeOptimization(iterations=32)\n' +
            'optimizer.set_experiment_guidelines(\n' +
            '   model_initializer=CatBoostClassifier,\n' +
            '   model_init_params=dict(\n' +
            '       iterations=100,\n' +
            '       eval_metric=Categorical([\'Logloss\', \'Accuracy\', \'AUC\']),\n' +
            '       learning_rate=Real(low=0.0001, high=0.5),\n' +
            '       depth=Integer(4, 7),\n' +
            '       allow_writing_files=False\n' +
            '   )\n' +
            ')\n' +
            'optimizer.go()'
        ),
        'rgf': (
            'optimizer = ExtraTreesOptimization(iterations=10)\n' +
            'optimizer.set_experiment_guidelines(\n' +
            '   model_initializer=RGFClassifier,\n' +
            '   model_init_params=dict(\n' +
            '       max_leaf=1000,\n' +
            '       algorithm=Categorical([\'RGF\', \'RGF_Opt\', \'RGF_Sib\']),\n' +
            '       l2=Real(0.01, 0.3),\n' +
            '       normalize=Categorical([True, False]),\n' +
            '       learning_rate=Real(0.3, 0.7),\n' +
            '       loss=Categorical([\'LS\', \'Expo\', \'Log\', \'Abs\'])\n' +
            '   )\n' +
            ')\n' +
            'optimizer.go()'
        )
    };


    $(document).ready(function () {
        // On Load:
        processOptimizeLibrarySelection();

        var buttonList = ['keras', 'sklearn', 'lightgbm', 'catboost', 'rgf', 'xgboost'];  // xgboost last because it starts there
        var i = 0;
        var optimizeInterval = setInterval(function() {
            selectedOptimizeLibrary = buttonList[i];
            processOptimizeLibrarySelection();
            i = (i < 5 ? i + 1 : 0);
        }, 3000);

        // On Event:
        $("button[class=optimize-library]").click(function () {
            clearInterval(optimizeInterval);
            selectedOptimizeLibrary = getButtonValue($(this));
            processOptimizeLibrarySelection();
        });
    });

    var processOptimizeLibrarySelection = function () {
        optimizeLibraryButtonsToDefault();
        var $activeOptimizeButton = $('#optimize-library-' + selectedOptimizeLibrary);
        // Update Button Style
        $activeOptimizeButton.css('color', activeButtonTextColor);
        $activeOptimizeButton.css('font-weight', 'bold');
        // Update Span Content
        updateOptimizeLibraryContent();
    };

    var updateOptimizeLibraryContent = function () {
        var content = '';
        content += '<pre><code class="python">';
        content += optimizeLibraryLookup[selectedOptimizeLibrary];
        content += '</code></pre>';
        // Set Content
        $('#optimizeLibraryContent').html(content);
        // Apply Syntax Highlighting
        $('pre code').each(function (i, block) {
            hljs.highlightBlock(block);
        });
    };

    var optimizeLibraryButtonsToDefault = function () {
        $("button[class=optimize-library]").each(function () {
            $(this).css('color', defaultButtonTextColor);
            $(this).css('font-weight', 'normal');
        });
    };

    var getButtonValue = function ($button) {
        var label = $button.text();
        $button.text('');
        var buttonValue = $button.val();
        $button.text(label);
        return buttonValue;
    };
</script>
</body>
</html>